(function(e){function t(t){for(var r,i,o=t[0],s=t[1],u=t[2],p=0,f=[];p<o.length;p++)i=o[p],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(f.length)f.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,o=1;o<n.length;o++){var s=n[o];0!==a[s]&&(r=!1)}r&&(c.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},c=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=s;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1555:function(e,t,n){},"452c":function(e,t,n){},5265:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app"},[e.isShowEdit?[n("CreateMapTree",{on:{back:e.onClickBack}},[n("button",{on:{click:e.onClickBack}},[e._v(" Вернуться к дереву ")])])]:[n("MapTree",{staticClass:"app-map-tree"},[n("button",{on:{click:e.onClickEdit}},[e._v(" Задать точки ")])]),n("Map",{staticClass:"app-map"}),n("SavedMapTree",{staticClass:"saved-map-tree"})]],2)},c=[],i=(n("a4d3"),n("4de4"),n("4160"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{ref:"map",staticClass:"map"}),n("button",{on:{click:e.onClickSave}},[e._v(" Сохранить маркеры в дерево ")]),e._t("default")],2)},s=[],u=(n("d81d"),n("d3b7"),n("07ac"),n("3ca3"),n("ddb0"),n("e11e")),l=n.n(u),p=n("5aec");delete l.a.Icon.Default.prototype._getIconUrl,l.a.Icon.Default.mergeOptions({iconRetinaUrl:n("584d"),iconUrl:n("6397"),shadowUrl:n("e2b9")});var f=l.a.tileLayer,d=l.a.map,b=l.a.marker,m=(p["a"].Nominatim,n("db22")),O=n.n(m),h=(n("6cc5"),n("bc59")),v="pk.eyJ1IjoiaXNocGFydGtvIiwiYSI6ImNrM25jdjYzbjFqMGMzZXJrMXpkOWFkOHMifQ.J7fINBkSi_1_QEogEdHr6g",j=(n("26e9"),n("fb6a"),n("ec41")),y=3,g=function(e){var t=e.reverse().slice(0,y);return{countryName:Object(j["a"])(t,"[0].text","Нет Страны"),regionName:Object(j["a"])(t,"[1].text","Нет Области"),cityName:Object(j["a"])(t,"[2].text","Нет Города")}},k=function(e,t){var n=e.id,r=e.position,a=g(t);return{id:n,title:a.cityName,position:r,isSaved:!1,isShowOnMap:!1,context:a}},P={position:[54.01713952011128,34.60835549517637],zoom:7,id:"mapbox/streets-v11"},w={data:function(){return{mainMap:null,points:{}}},mounted:function(){var e=this;this.mainMap=d(this.$refs.map,{center:P.position,zoom:P.zoom}),f("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:"",maxZoom:18,minZoom:4,id:P.id,accessToken:v}).addTo(this.mainMap),this.mainMap.on("click",(function(t){e.addPoint(t.latlng)}))},methods:{getNewId:function(){return O()("1234567890abcdefghigklmno",4)},addPoint:function(e){var t=this,n={id:this.getNewId(),position:e};r["a"].set(this.points,n.id,n);var a=b(e).addTo(this.mainMap);a.on("click",(function(){t.mainMap.removeLayer(a);var e=Object(h["a"])(t.points,n.id);e&&r["a"].delete(t.points,n.id)}))},createPlacesFromApi:function(){var e=this;return new Promise((function(t){var n=Object.values(e.points).map((function(t){return new Promise((function(n,r){e.$store.dispatch("getPlaceContextFromApi",t).then((function(e){n(k(t,e))})).catch((function(e){r(e)}))}))}));Promise.all(n).then((function(e){var n={};e.forEach((function(e){n[e.id]=e})),t(n)}))}))},onClickSave:function(){var e=this;this.createPlacesFromApi().then((function(t){e.$store.commit("places",t),e.$emit("back")}))}}},M=w,S=(n("5baf"),n("2877")),x=Object(S["a"])(M,o,s,!1,null,"6883191a",null),_=x.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"map",staticClass:"map"})},E=[],T=n("2f62");function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N={data:function(){return{mainMap:null,markerIdsOnMap:{}}},computed:D({},Object(T["b"])({mapMarkers:"mapMarkers",places:"places"})),watch:{mapMarkers:function(e){var t=this;null!==e&&e.forEach((function(e){t.addMarker(e)}))}},mounted:function(){this.mainMap=d(this.$refs.map,{center:P.position,zoom:P.zoom}),this.mainMap.on("contextmenu",(function(){})),f("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:"",maxZoom:18,id:P.id,accessToken:v}).addTo(this.mainMap)},methods:{addMarker:function(e){var t=this;if(!Object(h["a"])(this.markerIdsOnMap,e.id)){var n={draggable:"true",id:e.id};this.markerIdsOnMap[e.id]=b(e.position,n),this.markerIdsOnMap[e.id].on("click",(function(){t.$store.commit("saveMapMarker",e),t.mainMap.removeLayer(t.markerIdsOnMap[e.id]),r["a"].delete(t.markerIdsOnMap,e.id)})),this.markerIdsOnMap[e.id].on("dragend",(function(r){var a=r.target,c=a.getLatLng();a.setLatLng(c,n),a.bindPopup(c),a.update();var i=D({},t.places[e.id],{position:c});t.$store.dispatch("getPlaceContextFromApi",i).then((function(e){var n=g(e),r=D({},i,{context:n});t.$store.commit("updateSinglePlace",r)}))})),this.markerIdsOnMap[e.id].addTo(this.mainMap)}}}},$=N,L=(n("6019"),Object(S["a"])($,C,E,!1,null,"0adda58e",null)),F=L.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"map-tree-wrapper"},[e._t("default"),e.tree?n("ul",{staticClass:"map-tree"},e._l(e.tree,(function(t,r){return n("TreeListItem",{key:r,attrs:{place:t},on:{selected:e.onSelected}})})),1):e._e()],2)},J=[],H=(n("13d5"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.place?n("li",{staticClass:"tree-list-item",on:{click:function(t){return t.stopPropagation(),e.onSelected(e.place)}}},[n("span",{staticClass:"tree-list-item-title",class:{"tree-list-item_selected":e.isNeedToHightlight}},[e._v(" "+e._s(e.placeTitle)+" ")]),e.place.children?n("ul",e._l(e.place.children,(function(t,r){return n("TreeListItem",{key:r,attrs:{place:t},on:{selected:e.onSelected}})})),1):e._e()]):e._e()}),A=[],V=n("53ca"),B=n("d4ec"),U=n("bee2"),Z=function(){function e(){Object(B["a"])(this,e)}return Object(U["a"])(e,null,[{key:"isValid",value:function(e){var t=!0;return this.hasChildren(e)&&(t=this.isChildrenValid(e.children)),e.hasOwnProperty("title")&&t}},{key:"hasChildren",value:function(e){return e.hasOwnProperty("children")}},{key:"isChildrenValid",value:function(e){return"object"===Object(V["a"])(e)}}]),e}(),G={name:"TreeListItem",props:{place:{type:Object,required:!0,validator:function(e){return Z.isValid(e)}}},computed:{placeTitle:function(){return Object(j["a"])(this.place,"title",!1)||Object(j["a"])(this.place,"context[2]",!1)},isNeedToHightlight:function(){return Object(j["a"])(this.place,"isSaved",!1)||Object(j["a"])(this.place,"isShowOnMap",!1)}},methods:{onSelected:function(e){this.$emit("selected",e)}}},X=G,q=(n("759f"),Object(S["a"])(X,H,A,!1,null,"4a0facd6",null)),Q=q.exports,Y=n("a1a3");function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K={components:{TreeListItem:Q},computed:W({},Object(T["b"])({places:"places"}),{tree:function(){return this.createTreeFromPlaces(this.places)}}),methods:{onSelected:function(e){this.$store.commit("addMapMarkers",e)},getHashCode:function(e){var t,n,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)n=e.charCodeAt(t),r=(r<<5)-r+n,r|=0;return r},createTreeItem:function(e){return Object(i["a"])({},this.getHashCode(e.context.countryName),{title:e.context.countryName,children:Object(i["a"])({},this.getHashCode(e.context.regionName),{title:e.context.regionName,children:Object(i["a"])({},this.getHashCode(e.context.cityName),e)})})},createTreeFromPlaces:function(e){var t=this;return Object.values(e).reduce((function(e,n){var r=t.createTreeItem(W({},n));return Object(Y["a"])(r,e)}),{})}}},ee=K,te=(n("8277"),Object(S["a"])(ee,z,J,!1,null,null,null)),ne=te.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",e._l(e.savedPlaces,(function(t){return n("li",{key:t.id,staticClass:"saved-list-item",on:{click:function(n){return e.onClickDelete(t)}}},[e._v(" "+e._s(t.context.countryName+" => "+t.context.regionName+" => "+t.context.cityName)+" ")])})),0)},ae=[];function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe={computed:ie({},Object(T["b"])({savedPlaces:"savedPlaces"})),methods:{onClickDelete:function(e){this.$store.commit("unSaveMapMarker",e)}}},se=oe,ue=(n("c369"),Object(S["a"])(se,re,ae,!1,null,null,null)),le=ue.exports,pe=function(e){return JSON.parse(JSON.stringify(e))},fe=function(e){return JSON.parse(e)},de=function(e){return JSON.stringify(e)},be=function(){try{var e=localStorage.getItem("places");if(e)return fe(e)}catch(t){localStorage.removeItem("places")}},me=function(e){try{localStorage.setItem("places",de(pe(e)))}catch(t){throw new Error(t)}};function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve={name:"app",components:{Map:F,MapTree:ne,SavedMapTree:le,CreateMapTree:_},computed:he({},Object(T["b"])({places:"places"}),{isShowEdit:function(){return this.isEdit}}),data:function(){return{isEdit:!0}},created:function(){this.init()},methods:{init:function(){var e=be();e&&this.$store.commit("places",e),this.isEdit=0===Object.keys(this.places).length},onClickEdit:function(){this.isEdit=!0},onClickBack:function(){me(this.places),this.isEdit=!1}},watch:{places:function(){this.isEdit=!1}}},je=ve,ye=(n("fceb"),n("b0a0"),Object(S["a"])(je,a,c,!1,null,"68af108e",null)),ge=ye.exports,ke=(n("99af"),function(e){if(Z.isValid(e)){var t=[],n=function e(n){if(Z.hasChildren(n))for(var r=0,a=Object.values(n.children);r<a.length;r++){var c=a[r];e(c)}else t.push(n)};return n(e),t}}),Pe=n("6740"),we=n("bc3a"),Me=n.n(we);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}r["a"].use(T["a"]);var _e=new T["a"].Store({state:{places:{}},mutations:{places:function(e,t){e.places=xe({},t)},updateSinglePlace:function(e,t){Object(h["a"])(e.places,t.id)&&r["a"].set(e.places,t.id,t)},addMapMarkers:function(e,t){var n=ke(t);e.places=xe({},e.places,{},n.reduce((function(e,t){return xe({},e,Object(i["a"])({},t.id,xe({},t,{isShowOnMap:!0})))}),{}))},saveMapMarker:function(e,t){r["a"].set(e.places,t.id,xe({},e.places[t.id],{isSaved:!0,isShowOnMap:!1}))},unSaveMapMarker:function(e,t){r["a"].set(e.places,t.id,xe({},e.places[t.id],{isSaved:!1}))}},getters:{places:function(e){return e.places},savedPlaces:function(e,t){return Object(Pe["a"])(t.places,(function(e){return Object(j["a"])(e,"isSaved",!1)}))},mapMarkers:function(e,t){return Object(Pe["a"])(t.places,(function(e){return Object(j["a"])(e,"isShowOnMap",!1)}))}},actions:{getPlaceContextFromApi:function(e,t){return new Promise((function(e,n){Me.a.get("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t.position.lng,",").concat(t.position.lat,".json"),{params:{access_token:v}}).then((function(t){e(Object(j["a"])(t,"data.features[0].context",[]))})).catch((function(e){n(e)}))}))}},modules:{}});r["a"].config.productionTip=!1,new r["a"]({store:_e,render:function(e){return e(ge)}}).$mount("#app")},"5baf":function(e,t,n){"use strict";var r=n("7532"),a=n.n(r);a.a},6019:function(e,t,n){"use strict";var r=n("a93d"),a=n.n(r);a.a},7532:function(e,t,n){},"759f":function(e,t,n){"use strict";var r=n("ab97"),a=n.n(r);a.a},8277:function(e,t,n){"use strict";var r=n("1555"),a=n.n(r);a.a},a93d:function(e,t,n){},ab97:function(e,t,n){},b0a0:function(e,t,n){"use strict";var r=n("452c"),a=n.n(r);a.a},c369:function(e,t,n){"use strict";var r=n("5265"),a=n.n(r);a.a},cde5:function(e,t,n){},fceb:function(e,t,n){"use strict";var r=n("cde5"),a=n.n(r);a.a}});
//# sourceMappingURL=app.e15d30de.js.map